<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantaprezze</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- Pulsante menu su mobile -->
    <button class="menu-button" onclick="toggleSidebar()">‚ò∞ Menu</button>

    <!-- Sidebar -->
    <aside id="sidebar">
        <button class="close-button" onclick="toggleSidebar()">‚úñ Chiudi</button>
        <button class="menu-item" onclick="showHome()">üè† Home</button>
        <button class="menu-item" onclick="openRegisterForm()">üìù Registrati</button>
        <button class="menu-item" onclick="showScores()">üìä Punteggi Squadre</button>
    </aside>        

    <!-- Contenuto principale -->
    <div class="content-container">
        <main id="main-content">
            <h1>Cosa √® accaduto tra le prezze</h1>
            <div id="recentEvents">Nessun evento registrato.</div>
        </main>
    </div>

    <!-- Modale di registrazione -->
    <div id="registerOverlay" onclick="closeRegisterForm()"></div>
    <div id="registerForm">
        <h2>Registrazione Squadra</h2>
        <label for="ownerName">Nome Proprietario:</label>
        <input type="text" id="ownerName"><br><br>
        <label for="teamName">Nome Squadra:</label>
        <input type="text" id="teamName"><br><br>
        <p>Seleziona 3 giocatori (budget massimo: 15 denari):</p>
        <div id="playersContainer">
            <p>Caricamento giocatori...</p> <!-- Messaggio temporaneo -->
        </div>
        <button id="saveTeamBtn" onclick="registerTeam()" disabled>Salva Squadra</button>
        <button onclick="closeRegisterForm()">Chiudi</button>
    </div>

    <!-- Footer con immagine -->
    <footer>
        <img src="logo.png" alt="Fantaprezze Logo">
        <p>&copy; 2025 Fantaprezze</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCcAMM80Llo3E2zgMKtG4LnsBXSGVkEUnA",
            authDomain: "fanta-prezze.firebaseapp.com",
            projectId: "fanta-prezze",
            storageBucket: "fanta-prezze.firebasestorage.app",
            messagingSenderId: "812560261380",
            appId: "1:812560261380:web:e542772a617d1339fcf051",
            measurementId: "G-76FGRB1XYG"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("sidebar-open");
        }

        function showHome() {
            document.getElementById("main-content").innerHTML = `
                <h1>Cosa √® accaduto tra le prezze</h1>
                <div id="recentEvents">Nessun evento registrato.</div>
            `;
            toggleSidebar();
        }

        function showScores() {
            document.getElementById("main-content").innerHTML = `
                <h1>Punteggi Squadre</h1>
                <ul id="scoreList"></ul>
            `;
            loadScores();
            toggleSidebar();
        }

        function openRegisterForm() {
            document.getElementById("registerForm").style.display = "block";
            document.getElementById("registerOverlay").style.display = "block";
            loadPlayers();
        }

        function closeRegisterForm() {
            document.getElementById("registerForm").style.display = "none";
            document.getElementById("registerOverlay").style.display = "none";
        }

        async function loadPlayers() {
            const playersSnapshot = await getDocs(collection(db, "players"));
            const playersContainer = document.getElementById("playersContainer");
            playersContainer.innerHTML = "";

            playersSnapshot.forEach((doc) => {
                const player = doc.data();
                const playerCheckbox = document.createElement("label");
                playerCheckbox.innerHTML = `
                    <input type="checkbox" name="players" value="${player.name}-${player.cost}" onclick="checkPlayers()">
                    ${player.name} (${player.cost} denari)
                `;
                playersContainer.appendChild(playerCheckbox);
                playersContainer.appendChild(document.createElement("br"));
            });
        }

        function checkPlayers() {
            const selectedPlayers = document.querySelectorAll('input[name="players"]:checked');
            document.getElementById("saveTeamBtn").disabled = selectedPlayers.length !== 3;
        }

        async function loadScores() {
            const teamsSnapshot = await getDocs(collection(db, "teams"));
            const scoreList = document.getElementById("scoreList");
            scoreList.innerHTML = "";

            teamsSnapshot.forEach(doc => {
                const team = doc.data();
                const listItem = document.createElement("li");
                listItem.textContent = `${team.teamName}: ${team.score} punti`;
                scoreList.appendChild(listItem);
            });
        }

        window.onload = () => {
            loadScores();
            loadPlayers();
        };
    </script>
</body>
</html>
